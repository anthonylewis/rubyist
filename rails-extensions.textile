h1. Rails: Ruby and Framework Extensions

Sometimes you need to -monkeypatch- extend a specific Rails library, a Ruby core class, or a Gem. The flexibility of Ruby allows you to reopen an existing class/module to add new methods or modify existing ones.

The most common question is: where should I write these extensions? In fact, there are several places where these files can be stored, however not all folders are loaded at the same time. Also, some folders are not loaded at all (unless you require them) making your -hack- customization even less elegant.

h2. Convention

The following convention solves the problem attempting to respect the purpose of each Rails folder.

Create the following initializer and save it in the `/config/initializers/` folder with the name `_extruby.rb`. The name SHOULD be prefixed with a `_`, in this way Rails will load this file before all the other initializers in the same folder.

```ruby
Dir[File.expand_path("../../../lib/extruby/**/*.rb", __FILE__)].each { |f| require f }
```

Create the folder `/lib/extruby` which will contain all the extensions. To better organize the files, you SHOULD the following folder structure:

# TODO: explain structure

```
lib/extruby/
├── gem
│   └── postageapp-actionmailer
│       └── postage.rb
├── rails
│   └── ....rb
└── ruby
    ├── array-sorting.rb
    └── string-conversions.rb
```

Remember that Ruby extensions MUST be tested as any other method. Depending on your test framework (`Test::Unit`, `Shoulda`) you SHOULD create a corresponding test suite for any customization.

# TODO: update structure

```
spec/lib/extruby
└── ruby
    ├── mail_spec.rb
    ├── money_spec.rb
    ├── object_spec.rb
    └── super_struct_spec.rb
```

h2. Considerations

The solution presented above attempts to respect the purpose of each Rails folder.

# It uses an initializer, so that the extensions are loaded when the Rails framework is loaded. However, the extensions are not stored in the initializers folder to avoid cluttering the namespace.
# It prefixes the initializer with _ causing the initializer to be loaded before any initializer, making the extensions available as soon as possible.
# It uses a dedicated folder in the `lib` folder to store all the _library_ extensions.

h4. WARNING:

Thought Ruby allows you to reopen classes, you shouldn't abuse that feature. In particular, avoid changin existing methods, especially in the Ruby core or standard library. If you change the behavior of a method, your application might now working properly.

If you decide to add a new method, make sure you are using an unique name. Otherwise, if you are using a Gem which defines a method with the same name, something might not work as expected.

Be careful when you modify existing classes. Consider using "Inheritance":http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming) or "Composition":http://en.wikipedia.org/wiki/Object_composition.
